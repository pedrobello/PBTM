---
title: "The PBTM R-Package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{The PBTM R-Package}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Overview
#### Population-based Threshold Models (PBTM) Calculator - beta version. 
This R package combines existing PBTMs calculation, parameters output and respective plots. 

## Installation 
Installation of the package requires the "devtools" package. 

#### Install development version from Github
```
> devtools::install_github("pedrobello/PBTM")
```

#### Load package
```
> library("PBTM")
```

## Data preparation steps

Before using the PBTM package, data preparation and selection is required. Main steps are described below.

*    Download the template file (download <a href="https://raw.githubusercontent.com/pedrobello/PBTM/master/data/PBTM-R-Dt-Empty.csv" download> PBTM-R-Dt-Empty.csv </a> or the example file <a href="https://raw.githubusercontent.com/pedrobello/PBTM/master/data/PBTM-R-Dt-Sample.csv">PBTM-R-Dt-Sample.csv</a>).
*    Enter your data in the proper field and leave unsed columns in blank. Repeat the treatment information for all data points of that treatment. Description of all fields present in the template file in the table below.

```{r include=FALSE}
library(knitr)
library("PBTM")
library(dplyr)
library(kableExtra)
```

```{r echo=FALSE}
data(DatasetDesc)
kable(DatasetDesc) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "200px")

```

<br>

* Inform your working folder in R. Add the folder location of your data files.
```
> setwd("~/MyProjectFolder/MyDataFolder")
```
* Load Seeds data - Add the name of the data file (csv file)
```
> mydata <- read.csv("PBTM-R-Data-MyData.csv", header=T)
```
* In case the data file has more treatments than you wish to use on a partiular model calculation, filter only the data that will be used to calculate that particular model.
Some examples:
    + Thermal time model: Select only treatments with germination tested in water (wp = 0) for a particular seed lot (Treat.ID = 1)
      ``` 
      > TreatData <- subset(mydata, Treat.ID == 1 & Germ.wp==0)
      ```
    + Hydrotime model: Select only treatments with germination tested in a certain temperature (temp = 25C) for a particular seed lot (Treat.ID = 1)
      ``` 
      > TreatData <- subset(mydata, Treat.ID == 1 & Germ.temp==25)
      ```
    + Hydrothermal time suboptimal model: Select only treatments with germination tested in a certain temperature range (temp < 26C) for a particular seed lot (Treat.ID = 1)
      ``` 
      > TreatData <- subset(mydata, Treat.ID == 1 & Germ.temp < 26)
      ```
*    Whenever the data file is already filtered only with the data to be used in the model calculation, reference the filtered data to the TreatData data table (step already perfomed above when data filtering is required).
```
> TreatData <- mydata
```

## Model Selection 

After the data to be used in the model calculation is passed to the TreatData table, now define the model to be calculated. Currently, the following models are available for calculation:

```{r echo=FALSE}
data(Models)
kable(x = Models, format = "html", align = "c") %>%
  kable_styling() %>%
  column_spec(2, width = "17em", bold = T) %>%
  scroll_box(width = "100%", height = "400px")
```


The model is selected using the function "DefineModel()" with the respective code of the model as described above. Examples below.

```
> DefineModel(1.1)

[1] "Thermaltime suboptimal model selected"
```
```
> DefineModel(3.1)

[1] "Hydrothermal time suboptimal model selected"
```

## Basic Functions

### PlotRawData()
Plot your raw data to be used on model. Cumulative germination (or other measured signal) curves will be plotted against time in hours. Treatments legend will be created based on the selected model. The data to be used on the models and plotted here must be referenced to the **TreatData** data table.  

```{r}
data(TomatoQ2)
kable(TomatoQ2[1:5, 1:6], caption = "A knitr kable.")

TreatData <- subset(TomatoQ2, Treat.ID == 1 & Germ.wp==0)
TreatData

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
